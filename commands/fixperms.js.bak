const { SlashCommandBuilder } = require('@discordjs/builders');
const { InteractionType } = require('discord.js');

module.exports = {
    data: new SlashCommandBuilder()
        .setName('fixperms')
        .setDescription('Règle quelques problèmes de permissions'),
    async execute(interaction) {
        if (interaction.member.roles.cache.some(r => r.name === "Admin")) {
            console.log("Refreshing roles")
            await interaction.guild.roles.fetch();
            console.log("Getting roles")
            const paris = interaction.guild.roles.cache.find(role => role.name === "Paris") || await interaction.guild.roles.fetch('1016966906340704276');
            const bordeaux = interaction.guild.roles.cache.find(role => role.name === "Bordeaux") || await interaction.guild.roles.fetch('1016966938934657084');
            const vanilla = interaction.guild.roles.cache.find(role => role.name === "Vanilla") || await interaction.guild.roles.fetch('1017137520263311500');
            const modded = interaction.guild.roles.cache.find(role => role.name === "Moddé") || await interaction.guild.roles.fetch('1017137564496441374');
            console.log("Checking Paris");
            for (let m of paris.members) {
                if (!m.roles.cache.has("1018926458632146995")) {
                    m.roles.remove(paris);
                    console.log("Removed role of" + m.username);
                }
            }
            console.log("Checking Bordeaux")
            for (let m of bordeaux.members) {
                if (!await m.roles.cache.has("1018926458632146995")) {
                    m.roles.remove(bordeaux);
                    console.log("Removed role of" + m.username);
                }
            }
            console.log("Checking Vanilla")
            for (let m of vanilla.members) {
                if (!await m.roles.cache.has("1018926458632146995")) {
                    m.roles.remove(vanilla);
                    console.log("Removed role of" + m.username);
                }
            }
            console.log("Checking Moddé")
            for (let m of modded.members) {
                if (!await m.roles.cache.has("1018926458632146995")) {
                    m.roles.remove(modded);
                    console.log("Removed role of" + m.username);
                }
            }
            console.log("Done")
            await interaction.reply({content: "Done", ephemeral: true})
        }
        else {
            await interaction.reply({content: "**Vous n'avez pas la permission d'utiliser cette commande !**", ephemeral: true });
        }
    },
};
